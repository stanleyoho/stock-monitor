<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ËÇ°Á•®Áõ£ÊéßÂÑÄË°®Êùø v2.0 - Â§öÁ≠ñÁï•Êô∫ËÉΩÁ≥ªÁµ±</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style_ultra_compact.css') }}">
</head>
<body>
    <div class="container-fluid">
        <!-- È†ÇÈÉ®Â∞éËà™Ê¨Ñ - Ë∂ÖÁ∑äÊπä -->
        <nav class="navbar navbar-dark bg-dark">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">üìä ËÇ°Á•®Áõ£Êéß v2.0</a>
                <div class="navbar-nav ms-auto d-flex flex-row">
                    <span class="navbar-text me-2">Â§öÁ≠ñÁï•Êô∫ËÉΩÁ≥ªÁµ±</span>
                    <button class="btn btn-outline-light btn-sm" onclick="showStockManager()">ÁÆ°ÁêÜËÇ°Á•®</button>
                </div>
            </div>
        </nav>

        <!-- Á¨¨‰∏ÄË°åÔºöÂ∏ÇÂ†¥Ê¶ÇÊ≥ÅËàáÊäïË≥áÁµÑÂêàÁãÄÊÖã (ÁΩÆÈ†Ç) -->
        <div class="row mt-1">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">Â∏ÇÂ†¥Ê¶ÇÊ≥ÅËàáÊäïË≥áÁµÑÂêàÁãÄÊÖã</h6>
                            <small>Êõ¥Êñ∞: <span id="lastUpdate">--</span></small>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-3">
                                <div class="market-indicator">
                                    <div class="indicator-label">VIXÊåáÊï∏</div>
                                    <div class="indicator-value" id="vixLevel">--</div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="market-indicator">
                                    <div class="indicator-label">Â∏ÇÂ†¥ÊÉÖÁ∑í</div>
                                    <div class="indicator-value" id="marketSentiment">--</div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="market-indicator">
                                    <div class="indicator-label">ÁµÑÂêàÁ∏ΩÂÄº</div>
                                    <div class="indicator-value" id="portfolioValue">--</div>
                                </div>
                            </div>
                            <div class="col-3">
                                <div class="market-indicator">
                                    <div class="indicator-label">Âπ¥ÂåñÂ†±ÈÖ¨</div>
                                    <div class="indicator-value" id="expectedReturn">--</div>
                                </div>
                            </div>
                        </div>
                        <!-- ÊäïË≥áÁµÑÂêàË©≥Á¥∞ÁãÄÊÖã -->
                        <div id="portfolioDetails" class="mt-2"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Á¨¨‰∫åË°åÔºöÁ≠ñÁï•ÊéßÂà∂ËàáÊô∫ËÉΩ‰ø°Ëôü‰∏¶Êéí -->
        <div class="row mt-1">
            <!-- Â∑¶ÂÅ¥ÔºöÁ≠ñÁï•ÊéßÂà∂‰∏≠ÂøÉ -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">Á≠ñÁï•ÊéßÂà∂‰∏≠ÂøÉ</h6>
                            <button class="btn btn-outline-secondary btn-sm" onclick="compareStrategies()">ÊØîËºÉ</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="strategySelector" class="fixed-height-lg">
                            <div class="text-center">
                                <div class="spinner-border spinner-border-sm" role="status">
                                    <span class="visually-hidden">ËºâÂÖ•‰∏≠...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Âè≥ÂÅ¥ÔºöÊô∫ËÉΩ‰∫§Êòì‰ø°Ëôü -->
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">Êô∫ËÉΩ‰∫§Êòì‰ø°Ëôü - <span id="currentStrategy">--</span></h6>
                            <div>
                                <button class="btn btn-outline-secondary btn-sm" onclick="window.stockMonitor.toggleChartsView()">ÂúñË°®</button>
                                <button class="btn btn-outline-secondary btn-sm" onclick="window.stockMonitor.showRiskManagementPanel()">È¢®Èö™</button>
                                <button class="btn btn-outline-secondary btn-sm" onclick="refreshData()">Âà∑Êñ∞</button>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="signalsContainer" class="fixed-height-lg">
                            <div class="text-center">
                                <div class="spinner-border spinner-border-sm" role="status">
                                    <span class="visually-hidden">ËºâÂÖ•‰∏≠...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÂãïÊÖãÂπ≥Ë°°ÊèêÈÜí (Á∑äÊπäÁâà) -->
        <div class="row mt-1" id="rebalanceAlert" style="display: none;">
            <div class="col-12">
                <div class="alert alert-warning alert-sm">
                    <strong>‚öñÔ∏è ÂãïÊÖãÂπ≥Ë°°ÊèêÈÜí</strong>
                    <span id="rebalanceContent"></span>
                </div>
            </div>
        </div>

        <!-- ËÇ°ÂÉπÂúñË°®Èù¢Êùø (Èö±Ëóè) -->
        <div class="row mt-1" id="chartsPanel" style="display: none;">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">ËÇ°ÂÉπËµ∞Âã¢ÂúñË°®</h6>
                            <div>
                                <select class="form-select form-select-sm" id="chartStockSelector" onchange="window.stockMonitor.switchChartStock(this.value)" style="width: 100px;">
                                    <option value="">ÈÅ∏ÊìáËÇ°Á•®</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="stockChartsContainer" style="height: 300px;">
                            <canvas id="stockChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- È¢®Èö™ÁÆ°ÁêÜÈù¢Êùø (Èö±Ëóè) -->
        <div class="row mt-1" id="riskManagementPanel" style="display: none;">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">È¢®Èö™ÁÆ°ÁêÜÂª∫Ë≠∞</h6>
                            <button class="btn btn-outline-secondary btn-sm" onclick="window.stockMonitor.hideRiskManagementPanel()">ÈóúÈñâ</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="riskManagementContent" class="fixed-height-md"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Á≠ñÁï•ÊØîËºÉÈù¢Êùø (Èö±Ëóè) -->
        <div class="row mt-1" id="strategyComparisonPanel" style="display: none;">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <div class="d-flex justify-content-between align-items-center">
                            <h6 class="mb-0">Á≠ñÁï•Ë°®ÁèæÊØîËºÉ</h6>
                            <button class="btn btn-outline-secondary btn-sm" onclick="hideStrategyComparison()">ÈóúÈñâ</button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div id="strategyComparisonContent" class="fixed-height-md"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- È†êÊúüÂ†±ÈÖ¨ÂàÜÊûê (Á∑äÊπäÁâà) -->
        <div class="row mt-1">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h6 class="mb-0">È†êÊúüÂ†±ÈÖ¨ËàáÈ¢®Èö™ÂàÜÊûê</h6>
                    </div>
                    <div class="card-body">
                        <div id="expectedReturnsContainer" class="row">
                            <div class="col-md-4">
                                <div class="portfolio-summary">
                                    <div class="portfolio-item">
                                        <div class="portfolio-item-label">Êó•Â†±ÈÖ¨</div>
                                        <div class="portfolio-item-value" id="dailyReturn">--</div>
                                    </div>
                                    <div class="portfolio-item">
                                        <div class="portfolio-item-label">ÈÄ±Â†±ÈÖ¨</div>
                                        <div class="portfolio-item-value" id="weeklyReturn">--</div>
                                    </div>
                                    <div class="portfolio-item">
                                        <div class="portfolio-item-label">ÊúàÂ†±ÈÖ¨</div>
                                        <div class="portfolio-item-value" id="monthlyReturn">--</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="portfolio-summary">
                                    <div class="portfolio-item">
                                        <div class="portfolio-item-label">Â§èÊôÆÊØîÁéá</div>
                                        <div class="portfolio-item-value" id="sharpeRatio">--</div>
                                    </div>
                                    <div class="portfolio-item">
                                        <div class="portfolio-item-label">ÊúÄÂ§ßÂõûÊí§</div>
                                        <div class="portfolio-item-value" id="maxDrawdown">--</div>
                                    </div>
                                    <div class="portfolio-item">
                                        <div class="portfolio-item-label">Ê≥¢ÂãïÁéá</div>
                                        <div class="portfolio-item-value" id="volatility">--</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="portfolio-summary">
                                    <div class="portfolio-item">
                                        <div class="portfolio-item-label">ÂãùÁéá</div>
                                        <div class="portfolio-item-value" id="winRate">--</div>
                                    </div>
                                    <div class="portfolio-item">
                                        <div class="portfolio-item-label">‰∫§ÊòìÊ¨°Êï∏</div>
                                        <div class="portfolio-item-value" id="tradeCount">--</div>
                                    </div>
                                    <div class="portfolio-item">
                                        <div class="portfolio-item-label">ÊåÅËÇ°Â§©Êï∏</div>
                                        <div class="portfolio-item-value" id="holdDays">--</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- È†ÅËÖ≥Ë≥áË®ä (Ë∂ÖÁ∑äÊπä) -->
        <div class="row mt-1">
            <div class="col-12 text-center">
                <small class="text-muted">
                    ËÇ°Á•®Áõ£ÊéßÁ≥ªÁµ± v2.0 | Ëá™ÂãïÊõ¥Êñ∞: ÊØè5ÂàÜÈêò | 
                    <span id="systemStatus">Á≥ªÁµ±Ê≠£Â∏∏</span>
                </small>
            </div>
        </div>
    </div>

    <!-- Modal: ËÇ°Á•®ÁÆ°ÁêÜ -->
    <div class="modal fade" id="stockManagerModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">ËÇ°Á•®ÁÆ°ÁêÜ</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="stockManagerContent"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ToastÈÄöÁü•ÂÆπÂô® -->
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
        <div id="liveToast" class="toast" role="alert">
            <div class="toast-header">
                <strong class="me-auto">Á≥ªÁµ±ÈÄöÁü•</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
            <div class="toast-body" id="toastMessage"></div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/app_v2.js') }}"></script>

    <script>
        // ÂÖ®ÂüüÂáΩÊï∏ÂÆöÁæ©
        function refreshData() {
            if (window.stockMonitor) {
                window.stockMonitor.loadSignals();
                window.stockMonitor.loadPortfolio();
            }
        }

        function compareStrategies() {
            document.getElementById('strategyComparisonPanel').style.display = 'block';
            if (window.stockMonitor) {
                window.stockMonitor.compareStrategies();
            }
        }

        function hideStrategyComparison() {
            document.getElementById('strategyComparisonPanel').style.display = 'none';
        }

        function showStockManager() {
            const modal = new bootstrap.Modal(document.getElementById('stockManagerModal'));
            modal.show();
            if (window.stockMonitor) {
                window.stockMonitor.loadStockManager();
            }
        }

        function toggleAdvancedView() {
            const advanced = document.querySelectorAll('.advanced-info');
            const isHidden = advanced[0]?.style.display === 'none';
            advanced.forEach(el => {
                el.style.display = isHidden ? 'block' : 'none';
            });
            document.getElementById('advancedToggleText').textContent = isHidden ? 'Èö±ËóèË©≥Á¥∞' : 'È°ØÁ§∫Ë©≥Á¥∞';
        }

        // È†ÅÈù¢ËºâÂÖ•ÂÆåÊàêÂæåÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // ÂàùÂßãÂåñ‰∏ªÊéßÂà∂Âô®
            window.stockMonitor = new StockMonitorV2();
            
            // Ë®≠ÂÆöËá™ÂãïÊõ¥Êñ∞
            setInterval(refreshData, 300000); // ÊØè5ÂàÜÈêòÊõ¥Êñ∞‰∏ÄÊ¨°
        });
    </script>
</body>
</html>